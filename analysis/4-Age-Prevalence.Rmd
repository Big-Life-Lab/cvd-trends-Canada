---
title: "4-Age-Prevalence"
author: "Kitty Chen"
date: "19/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Both sex

```{r Hypertension}
library(srvyr)
library(dplyr)
library(tidyr)

svy_design <- as_survey_design(.data=harmonized_combined, weights="WTS_M")
ht_t1 <-svy_design %>%
  group_by(year,Age_Group, CCC_071) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(CCC_071 == 1) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100))
ht_t1
```

```{r Diabetes}
db_t1 <-svy_design %>%
  group_by(year,Age_Group, CCC_101) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(CCC_101 == 1) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100)) 
db_t1
```

```{r Blood cholesterol}
bc_t1 <-svy_design %>%
  group_by(year,Age_Group, CCC_075) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(CCC_075 == 1) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2015`) / `2015`*100)) 
bc_t1
```

```{r Obesity}
bmi_t1 <-svy_design %>%
  group_by(year,Age_Group,HWTGBMI_der_cat4) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(HWTGBMI_der_cat4 == 4) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100)) 
bmi_t1
```

```{r Physical inactivity}
mets_t1 <-svy_design %>%
  group_by(year,Age_Group, activity) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(activity=="Inactive") %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100)) 
mets_t1
```

```{r Smoking}
smoke_t1 <-svy_design %>%
  group_by(year,Age_Group, SMKDSTY_cat3) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(SMKDSTY_cat3 == 1) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100))
smoke_t1
```

```{r Drinking}
alc_t1 <-svy_design %>%
  group_by(year,Age_Group, Alcohol) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(Alcohol == 4) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100))
alc_t1
```

```{r Full table}
# Tb_t1 <- gtsummary::tbl_stack(list(alc_tb, bmi_tb,db_tb,ht_tb, mets_tb,smoke_tb))

```

## Male

```{r Hypertension}
library(srvyr)
library(dplyr)
library(tidyr)

combined_male <- harmonized_combined %>% filter(DHH_SEX == 1)
svy_design_male <- as_survey_design(.data=combined_male, weights="WTS_M")
ht_t1_male <-svy_design_male %>%
  group_by(year,Age_Group, CCC_071) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(CCC_071 == 1) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100))
ht_t1_male
```

```{r Diabetes}
db_t1_male <-svy_design_male %>%
  group_by(year,Age_Group, CCC_101) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(CCC_101 == 1) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100)) 
db_t1_male
```

```{r Blood cholesterol}
bc_t1_male <-svy_design_male %>%
  group_by(year,Age_Group, CCC_075) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(CCC_075 == 1) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2015`) / `2015`*100)) 
bc_t1_male
```

```{r Obesity}
bmi_t1_male <-svy_design_male %>%
  group_by(year,Age_Group,HWTGBMI_der_cat4) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(HWTGBMI_der_cat4 == 4) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100)) 
bmi_t1_male
```

```{r Physical inactivity}
mets_t1_male <-svy_design_male %>%
  group_by(year,Age_Group, activity) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(activity=="Inactive") %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100)) 
mets_t1_male
```

```{r Smoking}
smoke_t1_male <-svy_design_male %>%
  group_by(year,Age_Group, SMKDSTY_cat3) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(SMKDSTY_cat3 == 1) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100))
smoke_t1_male
```

```{r Drinking}
alc_t1_male <-svy_design_male %>%
  group_by(year,Age_Group, Alcohol) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(Alcohol == 4) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100))
alc_t1_male
```

```{r Full table}
# Tb_t1 <- gtsummary::tbl_stack(list(alc_tb, bmi_tb,db_tb,ht_tb, mets_tb,smoke_tb))

```

## Female

```{r Hypertension}
library(srvyr)
library(dplyr)
library(tidyr)

combined_female <- harmonized_combined %>% filter(DHH_SEX == 2)
svy_design_female <- as_survey_design(.data=combined_female, weights="WTS_M")
ht_t1_female <-svy_design_female %>%
  group_by(year,Age_Group, CCC_071) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(CCC_071 == 1) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100))
ht_t1_female
```

```{r Diabetes}
db_t1_female <-svy_design_female %>%
  group_by(year,Age_Group, CCC_101) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(CCC_101 == 1) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100)) 
db_t1_female
```

```{r Blood cholesterol}
bc_t1_female <-svy_design_female %>%
  group_by(year,Age_Group, CCC_075) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(CCC_075 == 1) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2015`) / `2015`*100)) 
bc_t1_female
```

```{r Obesity}
bmi_t1_female <-svy_design_female %>%
  group_by(year,Age_Group,HWTGBMI_der_cat4) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(HWTGBMI_der_cat4 == 4) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100)) 
bmi_t1_female
```

```{r Physical inactivity}
mets_t1_female <-svy_design_female %>%
  group_by(year,Age_Group, activity) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(activity=="Inactive") %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100)) 
mets_t1_female
```

```{r Smoking}
smoke_t1_female <-svy_design_female %>%
  group_by(year,Age_Group, SMKDSTY_cat3) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(SMKDSTY_cat3 == 1) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100))
smoke_t1_female
```


```{r Drinking}
alc_t1_female <-svy_design_female %>%
  group_by(year,Age_Group, Alcohol) %>%
  summarise(proportion = survey_mean()*100) %>%
  filter(Alcohol == 4) %>% 
  select(-proportion_se)%>%
  spread(year, proportion) %>%
  mutate(diff = ((`2017` - `2001`) / `2001`*100))
alc_t1_female
```

```{r}
```{r Full table}
# Tb_t1 <- gtsummary::tbl_stack(list(alc_tb, bmi_tb,db_tb,ht_tb, mets_tb,smoke_tb))

```


